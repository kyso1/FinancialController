<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="theme-color" content="#4f46e5" />
  <meta name="description" content="Controle Financeiro - Gerencie suas finan√ßas" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Controle Financeiro - Lan√ßamentos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            brand: { 50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81' }
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans">

  <!-- Navbar -->
  <nav class="sticky top-0 z-40 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-800/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex items-center justify-between h-16">
        <!-- Logo + Navega√ß√£o -->
        <div class="flex items-center gap-1 sm:gap-6">
          <a href="dashboard.html" class="flex items-center gap-2 text-brand-600 dark:text-brand-400 font-bold text-lg">
            <div class="w-8 h-8 bg-gradient-to-br from-brand-500 to-brand-700 rounded-lg flex items-center justify-center">
              <i class="bi bi-wallet2 text-white text-sm"></i>
            </div>
            <span class="hidden sm:inline">Financeiro</span>
          </a>
          <div class="flex items-center gap-1 ml-2">
            <a href="dashboard.html" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
              <i class="bi bi-grid-1x2 mr-1"></i><span class="hidden sm:inline">Dashboard</span>
            </a>
            <a href="index.html" class="px-3 py-2 rounded-lg text-sm font-medium bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-400 transition-colors">
              <i class="bi bi-receipt mr-1"></i><span class="hidden sm:inline">Lan√ßamentos</span>
            </a>
          </div>
        </div>

        <!-- A√ß√µes direita -->
        <div class="flex items-center gap-2">
          <!-- Notifica√ß√µes -->
          <button onclick="abrirModal('modalNotificacoes'); carregarNotificacoesPendentes();" class="relative p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" title="Notifica√ß√µes">
            <i class="bi bi-bell text-lg text-gray-500 dark:text-gray-400"></i>
            <span id="badgeNotificacoes" class="absolute -top-0.5 -right-0.5 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center hidden">0</span>
          </button>

          <!-- Perfil -->
          <div class="relative" id="perfilDropdownContainer">
            <button onclick="toggleDropdown('perfilDropdownMenu')" class="flex items-center gap-2 p-1.5 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
              <img id="fotoPerfilNav" src="https://ui-avatars.com/api/?name=U&background=6366f1&color=fff" class="w-8 h-8 rounded-full ring-2 ring-brand-500/20" alt="Perfil">
              <span id="nomeUsuarioNav" class="text-sm font-medium hidden md:inline">Usu√°rio</span>
              <i class="bi bi-chevron-down text-xs text-gray-400 hidden md:inline"></i>
            </button>
            <div id="perfilDropdownMenu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 hidden py-1 z-50">
              <a href="#" onclick="abrirModal('modalPerfil'); return false;" class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <i class="bi bi-person-circle"></i> Editar Perfil
              </a>
              <a href="#" onclick="abrirModal('modalAmigos'); carregarAmigos(); return false;" class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <i class="bi bi-people"></i> Amigos
                <span id="badgeAmigosPendentes" class="ml-auto w-5 h-5 bg-orange-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center hidden">0</span>
              </a>
              <hr class="border-gray-200 dark:border-gray-700 my-1">
              <a href="#" id="btnLogout" class="flex items-center gap-2 px-4 py-2.5 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors">
                <i class="bi bi-box-arrow-right"></i> Sair
              </a>
            </div>
          </div>

          <!-- Tema -->
          <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" title="Alternar tema">
            <i class="bi bi-moon-fill text-gray-500 dark:text-gray-400" id="themeIcon"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Conte√∫do -->
  <main class="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-6 pb-24 sm:pb-28">
    <!-- Filtros -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-4 mb-6 shadow-sm">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div>
          <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Tipo</label>
          <select id="filtroTipo" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/30 focus:border-brand-500 transition-all">
            <option value="">Todos</option>
            <option value="DESPESA">Despesas</option>
            <option value="RECEITA">Receitas</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Categoria</label>
          <select id="filtroCategoria" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/30 focus:border-brand-500 transition-all">
            <option value="">Todas</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Data Inicial</label>
          <input type="date" id="filtroDataInicio" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/30 focus:border-brand-500 transition-all">
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Data Final</label>
          <input type="date" id="filtroDataFim" class="w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500/30 focus:border-brand-500 transition-all">
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2 mt-3">
        <button id="btnAplicarFiltros" class="px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white text-sm font-medium rounded-xl transition-colors">
          <i class="bi bi-funnel mr-1"></i> Filtrar
        </button>
        <button id="btnLimparFiltros" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium rounded-xl transition-colors">
          <i class="bi bi-x-circle mr-1"></i> Limpar
        </button>
        <div class="hidden sm:block w-px h-6 bg-gray-200 dark:bg-gray-700 mx-1"></div>
        <div class="flex rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700">
          <button id="btnOrdenarData" class="px-3 py-2 text-xs font-medium bg-brand-50 dark:bg-brand-500/10 text-brand-700 dark:text-brand-400 transition-colors">
            <i class="bi bi-calendar mr-1"></i>Data
          </button>
          <button id="btnOrdenarValor" class="px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            <i class="bi bi-currency-dollar mr-1"></i>Valor
          </button>
        </div>
        <div class="hidden sm:block w-px h-6 bg-gray-200 dark:bg-gray-700 mx-1"></div>
        <!-- Ciclo de Fatura -->
        <div class="flex items-center gap-2">
          <button id="btnCicloFatura" class="px-3 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 hover:bg-amber-50 dark:hover:bg-amber-500/10 hover:text-amber-700 dark:hover:text-amber-400 rounded-xl border border-gray-200 dark:border-gray-700 transition-colors" title="Filtrar pelo ciclo de fatura do cart√£o (fecha dia 02, vence dia 09)">
            <i class="bi bi-credit-card mr-1"></i>Ciclo Fatura
          </button>
          <div id="cicloFaturaConfig" class="hidden flex items-center gap-2">
            <label class="text-[10px] text-gray-400">Fecha dia</label>
            <input type="number" id="diaFechamento" min="1" max="28" value="2" class="w-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-1 text-xs text-center focus:outline-none focus:ring-2 focus:ring-amber-500/30">
            <label class="text-[10px] text-gray-400">Vence dia</label>
            <input type="number" id="diaVencimento" min="1" max="28" value="9" class="w-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-1 text-xs text-center focus:outline-none focus:ring-2 focus:ring-amber-500/30">
          </div>
        </div>
        <div class="ml-auto flex gap-2">
          <button onclick="abrirModal('modalImportacao')" class="px-3 py-2 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-700 dark:text-emerald-400 text-sm font-medium rounded-xl hover:bg-emerald-100 dark:hover:bg-emerald-500/20 transition-colors">
            <i class="bi bi-upload mr-1"></i><span class="hidden sm:inline">Importar</span>
          </button>
          <div class="relative" id="exportDropdownContainer">
            <button onclick="toggleDropdown('exportDropdownMenu')" class="px-3 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
              <i class="bi bi-download mr-1"></i><span class="hidden sm:inline">Exportar</span> <i class="bi bi-chevron-down text-xs"></i>
            </button>
            <div id="exportDropdownMenu" class="absolute right-0 mt-2 w-44 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 hidden py-1 z-50">
              <a href="#" id="btnExportarExcel" class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <i class="bi bi-file-earmark-excel text-emerald-600"></i> Excel (.xlsx)
              </a>
              <a href="#" id="btnExportarCSV" class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <i class="bi bi-filetype-csv text-blue-600"></i> CSV (.csv)
              </a>
              <hr class="border-gray-200 dark:border-gray-700 my-1">
              <a href="#" id="btnEnviarEmail" class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <i class="bi bi-envelope text-brand-600"></i> Enviar por E-mail
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Card Saldo -->
    <div class="bg-gradient-to-r from-brand-600 via-brand-700 to-indigo-800 rounded-2xl p-6 text-center text-white shadow-xl shadow-brand-600/20 mb-6">
      <p class="text-sm text-white/70 uppercase tracking-wider font-medium">Saldo Atual</p>
      <h1 class="text-4xl sm:text-5xl font-extrabold mt-1 tracking-tight" id="saldo-total">R$ 0,00</h1>
    </div>

    <!-- Gr√°fico M√©todos de Pagamento -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 p-5 mb-6 shadow-sm">
      <h3 class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-4">M√©todos de Pagamento</h3>
      <div id="chartMetodosPagamento" class="min-h-[280px]"></div>
    </div>

    <!-- Lista de Lan√ßamentos -->
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider">√öltimos Lan√ßamentos</h3>
      <button id="btnMultiSelect" class="px-3 py-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 transition-colors" title="Selecionar v√°rios">
        <i class="bi bi-check2-square mr-1"></i>Selecionar
      </button>
    </div>
    <!-- Barra de sele√ß√£o em massa -->
    <div id="barraSelecao" class="hidden sticky top-16 z-30 bg-brand-600 text-white rounded-xl px-4 py-3 mb-3 shadow-lg flex flex-col sm:flex-row items-center justify-between gap-2 animate-slideUp">
      <div class="flex items-center gap-3">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="checkboxTodos" class="w-4 h-4 rounded border-white/30 text-white focus:ring-0 accent-white">
          <span class="text-sm font-medium">Todos</span>
        </label>
        <span id="contadorSelecionados" class="text-sm opacity-80">0 selecionados</span>
      </div>
      <div class="flex items-center gap-2 flex-wrap justify-center">
        <button id="btnEditarSelecionados" class="px-3 py-1.5 bg-amber-500 hover:bg-amber-600 text-white text-xs font-semibold rounded-lg transition-colors">
          <i class="bi bi-pencil mr-1"></i>Editar (<span id="qtdEditar">0</span>)
        </button>
        <button id="btnDeletarSelecionados" class="px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white text-xs font-semibold rounded-lg transition-colors">
          <i class="bi bi-trash mr-1"></i>Apagar (<span id="qtdDeletar">0</span>)
        </button>
        <button id="btnCancelarSelecao" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 text-white text-xs font-medium rounded-lg transition-colors">
          <i class="bi bi-x-lg mr-1"></i>Cancelar
        </button>
      </div>
    </div>
    <div id="lista-lancamentos" class="space-y-2">
      <div class="text-center py-8 text-gray-400">
        <i class="bi bi-hourglass-split text-2xl"></i>
        <p class="mt-2 text-sm">Carregando...</p>
      </div>
    </div>
  </main>

  <!-- FAB -->
  <button onclick="abrirModal('modalLancamento')"
    class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-br from-brand-500 to-brand-700 text-white rounded-2xl shadow-lg shadow-brand-600/40 hover:shadow-brand-500/60 flex items-center justify-center transition-all transform hover:scale-110 hover:rotate-90 z-30">
    <i class="bi bi-plus-lg text-2xl"></i>
  </button>

  <!-- ============ MODAIS ============ -->

  <!-- Modal: Novo Lan√ßamento -->
  <div id="modalLancamento" class="modal-overlay hidden">
    <div class="modal-container max-w-md">
      <div class="modal-header">
        <h3 class="text-lg font-bold">Novo Lan√ßamento</h3>
        <button onclick="fecharModal('modalLancamento')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5">
        <form id="form-lancamento" class="space-y-4">
          <input type="hidden" id="inputId" />
          <div>
            <label class="label-sm">Tipo de Lan√ßamento</label>
            <select id="inputTipo" onchange="ajustarFormulario()" class="input-field">
              <option value="DESPESA" selected>üî¥ Sa√≠da</option>
              <option value="RECEITA">üü¢ Extra</option>
              <option value="SALARIO">üí∞ Sal√°rio Mensal</option>
            </select>
          </div>
          <div>
            <label class="label-sm">Descri√ß√£o</label>
            <input type="text" id="inputDescricao" class="input-field" placeholder="Ex: Mercado, Luz..." required />
          </div>
          <div>
            <label class="label-sm">Valor (R$)</label>
            <input type="text" inputmode="numeric" id="inputValor" class="input-field" placeholder="0,00" required />
          </div>
          <div>
            <label class="label-sm">Data</label>
            <input type="date" id="inputData" class="input-field" required />
          </div>
          <div id="categoriaContainer">
            <label class="label-sm">Categoria</label>
            <select id="inputCategoria" class="input-field" required>
              <option value="">Selecione uma categoria</option>
            </select>
          </div>
          <div>
            <label class="label-sm">M√©todo de Pagamento</label>
            <select id="inputMetodoPagamento" class="input-field">
              <option value="">Selecione (opcional)</option>
              <option value="CARTAO_CREDITO">üí≥ Cart√£o de Cr√©dito</option>
              <option value="CARTAO_DEBITO">üí≥ Cart√£o de D√©bito</option>
              <option value="PIX">‚ö° PIX</option>
              <option value="BOLETO">üìÑ Boleto</option>
              <option value="TED">üè¶ TED</option>
              <option value="INVESTIMENTO">üìà Investimento</option>
            </select>
          </div>
          <label class="flex items-center gap-3 cursor-pointer">
            <div class="relative">
              <input type="checkbox" id="inputFixo" class="sr-only peer">
              <div class="w-10 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-brand-600 transition-colors"></div>
              <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow peer-checked:translate-x-4 transition-transform"></div>
            </div>
            <span class="text-sm text-gray-700 dark:text-gray-300">Repete todo m√™s? (Fixo)</span>
          </label>
        </form>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalLancamento')" class="btn-secondary">Cancelar</button>
        <button id="btn-salvar" class="btn-primary">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Importa√ß√£o -->
  <div id="modalImportacao" class="modal-overlay hidden">
    <div class="modal-container max-w-4xl">
      <div class="modal-header">
        <h3 class="text-lg font-bold">Importar Extrato</h3>
        <button onclick="fecharModalImportacao()" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>

      <!-- ETAPA 1: Sele√ß√£o do arquivo -->
      <div id="importEtapa1" class="p-5 space-y-4">
        <div class="bg-blue-50 dark:bg-blue-500/10 rounded-xl p-3 text-sm text-blue-700 dark:text-blue-300">
          <p class="font-medium mb-1">Formatos aceitos: OFX ou CSV</p>
          <p class="text-xs opacity-80"><strong>CSV:</strong> Data,Descri√ß√£o,Valor,Tipo<br>Exemplo: 01/01/2024,Compra supermercado,150.50,DESPESA</p>
        </div>
        <div>
          <label class="label-sm">Origem do Arquivo</label>
          <div class="flex gap-4 mt-1">
            <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors has-[:checked]:border-brand-500 has-[:checked]:bg-brand-50 dark:has-[:checked]:bg-brand-500/10">
              <input type="radio" name="tipoImportacao" value="CONTA" class="accent-brand-600">
              <span class="text-sm">üè¶ Extrato de Conta</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors has-[:checked]:border-brand-500 has-[:checked]:bg-brand-50 dark:has-[:checked]:bg-brand-500/10">
              <input type="radio" name="tipoImportacao" value="CARTAO" class="accent-brand-600" checked>
              <span class="text-sm">üí≥ Fatura de Cart√£o</span>
            </label>
          </div>
        </div>
        <div>
          <label class="label-sm">Selecione o arquivo</label>
          <input type="file" id="arquivoImportacao" accept=".ofx,.csv" class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:bg-brand-50 dark:file:bg-brand-500/10 file:text-brand-700 dark:file:text-brand-400 file:font-medium hover:file:bg-brand-100 dark:hover:file:bg-brand-500/20 cursor-pointer" />
        </div>
        <div id="progressoImportacao" class="hidden">
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden">
            <div class="bg-brand-600 h-full rounded-full animate-pulse w-full"></div>
          </div>
          <p class="text-xs text-gray-500 mt-1 text-center">Carregando preview...</p>
        </div>
      </div>

      <!-- ETAPA 2: Preview com tabela -->
      <div id="importEtapa2" class="hidden">
        <div class="px-5 pt-3 pb-2 flex items-center justify-between flex-wrap gap-2">
          <div class="flex items-center gap-3">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
              <span id="previewContador">0</span> lan√ßamentos encontrados
            </span>
            <span id="previewDuplicatas" class="hidden text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-500/10 px-2 py-0.5 rounded-full">
              <i class="bi bi-exclamation-triangle mr-1"></i><span id="previewDuplicatasCount">0</span> duplicata(s)
            </span>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="previewSelecionarTodos()" class="text-xs text-brand-600 dark:text-brand-400 hover:underline">Selecionar todos</button>
            <span class="text-gray-300 dark:text-gray-600">|</span>
            <button onclick="previewDesmarcarTodos()" class="text-xs text-gray-500 dark:text-gray-400 hover:underline">Desmarcar todos</button>
            <span class="text-gray-300 dark:text-gray-600">|</span>
            <button onclick="previewInverterSelecao()" class="text-xs text-gray-500 dark:text-gray-400 hover:underline">Inverter</button>
          </div>
        </div>
        <div class="px-5 pb-3 overflow-x-auto" style="max-height: 420px; overflow-y: auto;">
          <table class="w-full text-sm">
            <thead class="sticky top-0 bg-gray-50 dark:bg-gray-800 z-10">
              <tr class="text-left text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                <th class="px-3 py-2 w-8"><input type="checkbox" id="previewCheckAll" onchange="previewToggleTodos(this.checked)" class="accent-brand-600"></th>
                <th class="px-3 py-2">Data</th>
                <th class="px-3 py-2">Descri√ß√£o</th>
                <th class="px-3 py-2 text-right">Valor</th>
                <th class="px-3 py-2 text-center">Tipo</th>
                <th class="px-3 py-2 text-center hidden sm:table-cell">Parcela</th>
                <th class="px-3 py-2 text-center hidden sm:table-cell">Status</th>
              </tr>
            </thead>
            <tbody id="previewTabelaBody" class="divide-y divide-gray-100 dark:divide-gray-800">
            </tbody>
          </table>
        </div>
        <div class="px-5 py-3 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-2 text-sm">
          <div class="flex flex-wrap items-center gap-2 sm:gap-4">
            <span class="text-gray-500 dark:text-gray-400">Selecionados: <strong id="previewSelecionadosCount" class="text-gray-800 dark:text-gray-200">0</strong></span>
            <span class="text-emerald-600 dark:text-emerald-400 font-medium">Receitas: <span id="previewTotalReceitas">R$ 0,00</span></span>
            <span class="text-red-500 dark:text-red-400 font-medium">Despesas: <span id="previewTotalDespesas">R$ 0,00</span></span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="btnVoltarImport" onclick="voltarEtapaImport()" class="btn-secondary hidden"><i class="bi bi-arrow-left mr-1"></i> Voltar</button>
        <button onclick="fecharModalImportacao()" class="btn-secondary">Cancelar</button>
        <button id="btnPreviewImport" onclick="carregarPreview()" class="btn-primary"><i class="bi bi-eye mr-1"></i> Visualizar</button>
        <button id="btnConfirmarImport" onclick="confirmarImportacao()" class="btn-primary hidden"><i class="bi bi-check-lg mr-1"></i> Importar Selecionados</button>
      </div>
    </div>
  </div>

  <!-- Modal: Perfil (com abas) -->
  <div id="modalPerfil" class="modal-overlay hidden">
    <div class="modal-container max-w-lg">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-person-gear mr-2"></i>Meu Perfil</h3>
        <button onclick="fecharModal('modalPerfil')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>

      <!-- Tabs -->
      <div class="flex border-b border-gray-200 dark:border-gray-700 px-5">
        <button onclick="trocarAbaPerfil('dados')" id="tabDados" class="tab-perfil-btn px-4 py-2.5 text-sm font-medium border-b-2 border-brand-500 text-brand-600 dark:text-brand-400 transition-colors">
          <i class="bi bi-person mr-1"></i> Dados
        </button>
        <button onclick="trocarAbaPerfil('seguranca')" id="tabSeguranca" class="tab-perfil-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
          <i class="bi bi-shield-lock mr-1"></i> Seguran√ßa
        </button>
        <button onclick="trocarAbaPerfil('preferencias')" id="tabPreferencias" class="tab-perfil-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
          <i class="bi bi-palette mr-1"></i> Prefer√™ncias
        </button>
      </div>

      <!-- Aba: Dados -->
      <div id="painelDados" class="aba-perfil-painel p-5 space-y-4">
        <div class="text-center">
          <div class="relative inline-block">
            <img id="previewFotoPerfil" src="https://ui-avatars.com/api/?name=U&background=6366f1&color=fff" class="w-24 h-24 rounded-full ring-4 ring-brand-500/20 object-cover" alt="">
            <label for="inputFotoArquivo" class="absolute bottom-0 right-0 w-8 h-8 bg-brand-500 hover:bg-brand-600 text-white rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-colors">
              <i class="bi bi-camera text-sm"></i>
            </label>
            <input type="file" id="inputFotoArquivo" accept="image/*" class="hidden" onchange="previewFotoSelecionada(this)">
          </div>
          <p class="text-xs text-gray-400 mt-2">Clique no √≠cone para alterar a foto</p>
        </div>
        <div>
          <label class="label-sm">Nome</label>
          <input type="text" id="inputNomePerfil" class="input-field" placeholder="Seu nome">
        </div>
        <div>
          <label class="label-sm">E-mail</label>
          <input type="email" id="inputEmailPerfil" class="input-field" placeholder="seu@email.com">
        </div>
        <div class="pt-2">
          <button id="btnSalvarPerfil" class="btn-primary w-full"><i class="bi bi-check-lg mr-1"></i> Salvar Dados</button>
        </div>
      </div>

      <!-- Aba: Seguran√ßa -->
      <div id="painelSeguranca" class="aba-perfil-painel hidden p-5 space-y-4">
        <div class="bg-amber-50 dark:bg-amber-500/10 border border-amber-200 dark:border-amber-500/20 rounded-xl p-3">
          <p class="text-xs text-amber-700 dark:text-amber-400"><i class="bi bi-info-circle mr-1"></i> A senha atual √© obrigat√≥ria para confirmar a altera√ß√£o.</p>
        </div>
        <div>
          <label class="label-sm">Senha Atual</label>
          <div class="relative">
            <input type="password" id="inputSenhaAtual" class="input-field pr-10" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button type="button" onclick="toggleSenhaVisivel('inputSenhaAtual', this)" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>
        <div>
          <label class="label-sm">Nova Senha</label>
          <div class="relative">
            <input type="password" id="inputNovaSenha" class="input-field pr-10" placeholder="M√≠nimo 6 caracteres">
            <button type="button" onclick="toggleSenhaVisivel('inputNovaSenha', this)" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>
        <div>
          <label class="label-sm">Confirmar Nova Senha</label>
          <div class="relative">
            <input type="password" id="inputConfirmarSenha" class="input-field pr-10" placeholder="Repita a nova senha">
            <button type="button" onclick="toggleSenhaVisivel('inputConfirmarSenha', this)" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>
        <div class="pt-2">
          <button id="btnSalvarSenha" class="btn-primary w-full"><i class="bi bi-shield-check mr-1"></i> Alterar Senha</button>
        </div>
      </div>

      <!-- Aba: Prefer√™ncias -->
      <div id="painelPreferencias" class="aba-perfil-painel hidden p-5 space-y-4">
        <div>
          <label class="label-sm">Tema da Interface</label>
          <div class="grid grid-cols-3 gap-3 mt-2">
            <label class="relative cursor-pointer">
              <input type="radio" name="temaPerfil" value="light" class="peer sr-only">
              <div class="flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 peer-checked:border-brand-500 peer-checked:bg-brand-50 dark:peer-checked:bg-brand-500/10 transition-all">
                <div class="w-10 h-10 rounded-full bg-gray-100 border-2 border-gray-300 flex items-center justify-center">
                  <i class="bi bi-sun-fill text-amber-500"></i>
                </div>
                <span class="text-xs font-medium">Claro</span>
              </div>
            </label>
            <label class="relative cursor-pointer">
              <input type="radio" name="temaPerfil" value="dark" class="peer sr-only">
              <div class="flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 peer-checked:border-brand-500 peer-checked:bg-brand-50 dark:peer-checked:bg-brand-500/10 transition-all">
                <div class="w-10 h-10 rounded-full bg-gray-800 border-2 border-gray-600 flex items-center justify-center">
                  <i class="bi bi-moon-fill text-blue-400"></i>
                </div>
                <span class="text-xs font-medium">Escuro</span>
              </div>
            </label>
            <label class="relative cursor-pointer">
              <input type="radio" name="temaPerfil" value="auto" class="peer sr-only">
              <div class="flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 peer-checked:border-brand-500 peer-checked:bg-brand-50 dark:peer-checked:bg-brand-500/10 transition-all">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-100 to-gray-800 border-2 border-gray-400 flex items-center justify-center">
                  <i class="bi bi-circle-half text-gray-500"></i>
                </div>
                <span class="text-xs font-medium">Autom√°tico</span>
              </div>
            </label>
          </div>
        </div>
        <div class="pt-2">
          <button id="btnSalvarPreferencias" class="btn-primary w-full"><i class="bi bi-check-lg mr-1"></i> Salvar Prefer√™ncias</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal: Notifica√ß√µes -->
  <div id="modalNotificacoes" class="modal-overlay hidden">
    <div class="modal-container max-w-lg">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-bell mr-2"></i>Gastos Compartilhados</h3>
        <button onclick="fecharModal('modalNotificacoes')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5 max-h-[60vh] overflow-y-auto" id="listaNotificacoes">
        <p class="text-center text-gray-400 py-4">Carregando...</p>
      </div>
    </div>
  </div>

  <!-- Modal: Compartilhar Gasto -->
  <div id="modalCompartilhar" class="modal-overlay hidden">
    <div class="modal-container max-w-md">
      <div class="modal-header">
        <h3 class="text-lg font-bold">Compartilhar Gasto</h3>
        <button onclick="fecharModal('modalCompartilhar')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5 space-y-4">
        <input type="hidden" id="lancamentoCompartilharId">
        <div>
          <label class="label-sm">Selecionar Usu√°rio</label>
          <select id="selectUsuarioCompartilhamento" class="input-field">
            <option value="">Selecione um usu√°rio...</option>
          </select>
        </div>
        <div>
          <label class="label-sm">Tipo de Compartilhamento</label>
          <select id="selectTipoCompartilhamento" class="input-field">
            <option value="DIVISAO">Dividir custo</option>
            <option value="EMPRESTIMO">Empr√©stimo</option>
            <option value="REEMBOLSO">Reembolso</option>
            <option value="INFORMATIVO">Apenas informar</option>
          </select>
        </div>
        <div>
          <label class="label-sm">Descri√ß√£o</label>
          <textarea id="inputDescricaoCompartilhamento" rows="3" class="input-field" placeholder="Por que est√° compartilhando este gasto?"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalCompartilhar')" class="btn-secondary">Cancelar</button>
        <button id="btnEnviarCompartilhamento" class="btn-primary">Compartilhar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Or√ßamento -->
  <div id="modalOrcamento" class="modal-overlay hidden">
    <div class="modal-container max-w-sm">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-pie-chart mr-2"></i>Definir Or√ßamento</h3>
        <button onclick="fecharModal('modalOrcamento')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5 space-y-4">
        <div>
          <label class="label-sm">Categoria</label>
          <select id="inputOrcamentoCategoria" class="input-field">
            <option value="">Selecione...</option>
            <option value="LAZER">Lazer</option>
            <option value="CASA">Casa</option>
            <option value="ALIMENTACAO">Alimenta√ß√£o</option>
            <option value="TRANSPORTE">Transporte</option>
            <option value="SA√öDE">Sa√∫de</option>
            <option value="OUTROS">Outros</option>
          </select>
        </div>
        <div>
          <label class="label-sm">Limite Mensal (R$)</label>
          <input type="number" step="0.01" id="inputOrcamentoLimite" class="input-field" placeholder="500,00">
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalOrcamento')" class="btn-secondary">Cancelar</button>
        <button id="btnSalvarOrcamento" class="btn-primary">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Meta de Economia -->
  <div id="modalMeta" class="modal-overlay hidden">
    <div class="modal-container max-w-sm">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-bullseye mr-2"></i>Nova Meta</h3>
        <button onclick="fecharModal('modalMeta')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5 space-y-4">
        <div>
          <label class="label-sm">Nome da Meta</label>
          <input type="text" id="inputMetaNome" class="input-field" placeholder="Ex: Viagem, Notebook...">
        </div>
        <div>
          <label class="label-sm">Valor Objetivo (R$)</label>
          <input type="number" step="0.01" id="inputMetaValor" class="input-field" placeholder="5000,00">
        </div>
        <div>
          <label class="label-sm">Data Limite (opcional)</label>
          <input type="date" id="inputMetaData" class="input-field">
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalMeta')" class="btn-secondary">Cancelar</button>
        <button id="btnSalvarMeta" class="btn-primary">Criar Meta</button>
      </div>
    </div>
  </div>

  <!-- Modal: Tag -->
  <div id="modalTag" class="modal-overlay hidden">
    <div class="modal-container max-w-xs">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-tag mr-2"></i>Nova Tag</h3>
        <button onclick="fecharModal('modalTag')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5">
        <label class="label-sm">Nome da Tag</label>
        <input type="text" id="inputTagNome" class="input-field" placeholder="Ex: viagem, urgente...">
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalTag')" class="btn-secondary">Cancelar</button>
        <button id="btnCriarTag" class="btn-primary">Criar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirma√ß√£o -->
  <div id="modalConfirmacao" class="modal-overlay hidden">
    <div class="modal-container max-w-sm">
      <div class="modal-header">
        <h3 class="text-lg font-bold" id="tituloConfirmacao">Confirma√ß√£o</h3>
        <button onclick="fecharModal('modalConfirmacao')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5">
        <p id="mensagemConfirmacao" class="text-gray-600 dark:text-gray-300"></p>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalConfirmacao')" class="btn-secondary" id="btnConfirmarNao">Cancelar</button>
        <button id="btnConfirmarSim" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-xl transition-colors">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Alerta -->
  <div id="modalAlerta" class="modal-overlay hidden">
    <div class="modal-container max-w-sm">
      <div class="modal-header">
        <h3 class="text-lg font-bold" id="tituloAlerta">Aviso</h3>
        <button onclick="fecharModal('modalAlerta')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5">
        <p id="mensagemAlerta" class="text-gray-600 dark:text-gray-300"></p>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalAlerta')" class="btn-primary" id="btnFecharAlerta">OK</button>
      </div>
    </div>
  </div>

  <!-- Modal: Editar M√©todo de Pagamento em Lote -->
  <div id="modalEditarMetodo" class="modal-overlay hidden">
    <div class="modal-container max-w-sm">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-pencil-square mr-2"></i>Editar M√©todo de Pagamento</h3>
        <button onclick="fecharModal('modalEditarMetodo')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="p-5 space-y-4">
        <p class="text-sm text-gray-500 dark:text-gray-400">Alterar o m√©todo de pagamento de <strong id="qtdEditarModal">0</strong> lan√ßamento(s):</p>
        <div>
          <label class="label-sm">M√©todo de Pagamento</label>
          <select id="inputMetodoLote" class="input-field">
            <option value="">Selecione...</option>
            <option value="CARTAO_CREDITO">üí≥ Cart√£o de Cr√©dito</option>
            <option value="CARTAO_DEBITO">üí≥ Cart√£o de D√©bito</option>
            <option value="PIX">‚ö° PIX</option>
            <option value="BOLETO">üìÑ Boleto</option>
            <option value="TED">üè¶ TED</option>
            <option value="INVESTIMENTO">üìà Investimento</option>
          </select>
        </div>
        <div class="bg-amber-50 dark:bg-amber-500/10 rounded-xl p-3 text-sm text-amber-700 dark:text-amber-300">
          <i class="bi bi-info-circle mr-1"></i>
          Ao selecionar <strong>Investimento</strong>, a categoria ser√° automaticamente alterada para "Investimento".
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="fecharModal('modalEditarMetodo')" class="btn-secondary">Cancelar</button>
        <button id="btnConfirmarEditarMetodo" class="btn-primary">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Amigos -->
  <div id="modalAmigos" class="modal-overlay hidden">
    <div class="modal-container max-w-lg">
      <div class="modal-header">
        <h3 class="text-lg font-bold"><i class="bi bi-people mr-2"></i>Amigos</h3>
        <button onclick="fecharModal('modalAmigos')" class="modal-close-btn"><i class="bi bi-x-lg"></i></button>
      </div>

      <!-- Tabs de amigos -->
      <div class="flex border-b border-gray-200 dark:border-gray-700 px-5">
        <button onclick="trocarAbaAmigos('lista')" id="tabAmigosLista" class="tab-amigo-btn px-4 py-2.5 text-sm font-medium border-b-2 border-brand-500 text-brand-600 dark:text-brand-400 transition-colors">
          <i class="bi bi-people-fill mr-1"></i> Meus Amigos
        </button>
        <button onclick="trocarAbaAmigos('pendentes')" id="tabAmigosPendentes" class="tab-amigo-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors relative">
          <i class="bi bi-clock-history mr-1"></i> Pendentes
          <span id="badgePendentesTab" class="ml-1 w-5 h-5 bg-orange-500 text-white text-[10px] font-bold rounded-full inline-flex items-center justify-center hidden">0</span>
        </button>
        <button onclick="trocarAbaAmigos('adicionar')" id="tabAmigosAdicionar" class="tab-amigo-btn px-4 py-2.5 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
          <i class="bi bi-person-plus mr-1"></i> Adicionar
        </button>
      </div>

      <!-- Aba: Lista de Amigos -->
      <div id="painelAmigosLista" class="aba-amigo-painel p-5">
        <div id="listaAmigos" class="space-y-3">
          <p class="text-center text-gray-400 py-6 text-sm">Carregando...</p>
        </div>
      </div>

      <!-- Aba: Solicita√ß√µes Pendentes -->
      <div id="painelAmigosPendentes" class="aba-amigo-painel hidden p-5">
        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Recebidas</h4>
        <div id="listaPendentesRecebidos" class="space-y-3 mb-6">
          <p class="text-center text-gray-400 py-4 text-sm">Nenhuma solicita√ß√£o pendente</p>
        </div>
        <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Enviadas</h4>
        <div id="listaPendentesEnviados" class="space-y-3">
          <p class="text-center text-gray-400 py-4 text-sm">Nenhuma solicita√ß√£o enviada</p>
        </div>
      </div>

      <!-- Aba: Adicionar Amigo -->
      <div id="painelAmigosAdicionar" class="aba-amigo-painel hidden p-5">
        <div class="relative mb-4">
          <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input type="text" id="inputBuscarAmigo" class="input-field pl-10" placeholder="Buscar por nome de usu√°rio..." />
        </div>
        <div id="resultadoBuscarAmigo" class="space-y-3">
          <p class="text-center text-gray-400 py-4 text-sm">Digite para buscar usu√°rios</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="js/app.js"></script>
</body>
</html>
